<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>covidregionaldata System Maintenance Guide • covidregionaldata</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>




<meta property="og:title" content="covidregionaldata System Maintenance Guide" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">covidregionaldata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
<li>
  <a href="reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/epiforecasts/covidregionaldata">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>covidregionaldata System Maintenance Guide</h1>
    </div>

<div id="covidregionaldata-system-maintenance-guide" class="section level1">

<div id="using-this-guide" class="section level2">
<h2 class="hasAnchor">
<a href="#using-this-guide" class="anchor"></a>Using this Guide</h2>
<p>This guide is for those wishing to contribute code to the covidregionaldata package. For details on how the package works and its general functionality, as well as installation, see the main README.md file in this repository.</p>
<p>We are working to improve and expand the package: please see the <a href="https://github.com/epiforecasts/covidregionaldata/issues">Issues</a> and feel free to comment. We are keen to standardise geocoding (issues <a href="https://github.com/epiforecasts/covidregionaldata/issues/81">#81</a> and <a href="https://github.com/epiforecasts/covidregionaldata/issues/84">#84</a>) and include data on priority countries (<a href="https://github.com/epiforecasts/covidregionaldata/issues/72">#72</a>). As our capacity is limited, we would very much appreciate any help on these and welcome new pull requests.</p>
</div>
<div id="set-up" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up" class="anchor"></a>Set up</h2>
<p>Set your working directory to the home directory of this project (or use the provided RStudio project). Install the analysis and all dependencies with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw">remotes</span>::<span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"epiforecasts/covidregionaldata"</span>, dependencies = <span class="fl">TRUE</span>)
</pre></div>
<div id="render-documentation" class="section level3">
<h3 class="hasAnchor">
<a href="#render-documentation" class="anchor"></a>Render documentation</h3>
<p>Render the documentation with the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">Rscript</span> inst/scripts/render_output.R</span></code></pre></div>
</div>
<div id="docker" class="section level3">
<h3 class="hasAnchor">
<a href="#docker" class="anchor"></a>Docker</h3>
<p>This package is developed in a docker container based on the tidyverse docker image.</p>
<p>To build the docker image run (from the <code>covidregionaldata</code> directory):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">docker</span> build . -t covidregionaldata</span></code></pre></div>
<p>To run the docker image run:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="ex">docker</span> run -d -p 8787:8787 --name covidregionaldata -e USER=covidregionaldata -e PASSWORD=covidregionaldata covidregionaldata</span></code></pre></div>
<p>The rstudio client can be found on port :8787 at your local machines IP. The default username:password is covidregionaldata:covidregionaldata, set the user with -e USER=username, and the password with - e PASSWORD=newpasswordhere. The default is to save the analysis files into the user directory.</p>
<p>To mount a folder (from your current working directory - here assumed to be <code>tmp</code>) in the docker container to your local system use the following in the above docker run command (as given mounts the whole <code>covidregionaldata</code> directory to <code>tmp</code>).</p>
<p><code>{bash, eval = FALSE} --mount type=bind,source=$(pwd)/tmp,target=/home/covidregionaldata</code></p>
<p>To access the command line run the following: <code>{bash, eval = FALSE} docker exec -ti covidregionaldata bash</code></p>
<p>Alternatively the package environment can be accessed via <a href="https://mybinder.org/v2/gh/epiforecasts/covidregionaldata/master?urlpath=rstudio">binder</a>.</p>
</div>
</div>
<div id="development" class="section level2">
<h2 class="hasAnchor">
<a href="#development" class="anchor"></a>Development</h2>
<div id="architecture" class="section level3">
<h3 class="hasAnchor">
<a href="#architecture" class="anchor"></a>Architecture</h3>
<p>covidregionaldata has three main data getter functions. They all return different formats of the same data. The majority of the functionality for all three functions is kept in the <code>get_regional_covid_data()</code> function. The three main functions are essentially wrappers around this with some formatting to reach the desired output. <code>get_regional_covid_data()</code> calls country-specific data getters (dependent on the country given by the user), and then mostly uses helpers from the <code>helper.R</code> file to clean and sanitise the data.</p>
<p>In general these are the steps it follows (see picture below for a diagram).</p>
<ol>
<li>Handling errors related to arguments.</li>
<li>Getting data using the <code>get_&lt;country&gt;_regional_cases()</code> function for the relevant country.</li>
<li>Getting the ISO codes for the country using <code>get_iso_codes(&lt;country&gt;)</code>
</li>
<li>Cleaning the data using some of the helper functions.</li>
<li>
<em>If</em> the user requested totals only, returning the data (summing up of the data is done in the <code>get_totals_only_regional_covid_data()</code> function).</li>
<li>
<em>If not</em>, further cleaning using the helper functions.</li>
<li>Returning data in the wide format (<code>get_long_format_regional_covid_data()</code> then converts it to long format).</li>
</ol>
<p align="center">
<img src="architecture_main.png" alt="architecture"></p>
</div>
<div id="common-tasks" class="section level3">
<h3 class="hasAnchor">
<a href="#common-tasks" class="anchor"></a>Common Tasks</h3>
<div id="adding-a-new-country-to-the-data-getter-functions" class="section level4">
<h4 class="hasAnchor">
<a href="#adding-a-new-country-to-the-data-getter-functions" class="anchor"></a><strong>Adding a new country to the data getter functions</strong>
</h4>
<p>This is the most common task for developers. You will need a source of raw data before starting. Note that for the data to be suitable it must be:</p>
<ul>
<li>reliable, valid and accurate</li>
<li>updated daily</li>
<li>at a sub-region level (i.e. states, counties, provinces)</li>
<li>publicly available</li>
</ul>
<p>You then need to follow these steps:</p>
<ol>
<li><p>Create a <code>get_&lt;country&gt;_regional_cases()</code> function. As described above, this needs to load the raw data, select <em>only</em> the relevant columns and change the names of the columns to the package standards. For some countries there may be multiple data sources, in which case using the <code>dplyr</code> join functions is recommended. There is no need to deal with NA values at this point, or to calculate new data. If the country supports level 2 regions, you should create a <code>get_&lt;country&gt;_regional_cases_only_level_1_regions()</code> and <code>get_&lt;country&gt;_regional_cases_with_level_2_regions()</code>. While these will share code, it saves writing one function with messy and confusing if statements.</p></li>
<li><p>Create unit tests for the function(s). At a minimum you should have tests which:</p></li>
</ol>
<ul>
<li>check if the data source is there, returns data and returns the expected columns</li>
<li>check that your function returns data columns with the correct names</li>
<li>check that your function returns data columns of the correct type (double for count data, character for metadata and Date for dates)</li>
</ul>
<ol>
<li><p>Write documentation using <code>#'</code> roxygen styling and then call <code>roxygen2::roxygenise()</code> when done to update the manual and NAMESPACE. There is no need to export your function but be sure to import any functions you do use from other packages.</p></li>
<li><p>Add your function(s) in the switch() calls in the <code>get_regional_covid_data()</code>, <code>get_iso_codes()</code> and <code>rename_region_column()</code> functions. ISO-3166-2 codes can be found using Wikipedia.</p></li>
</ol>
</div>
<div id="writing-new-helper-functions" class="section level4">
<h4 class="hasAnchor">
<a href="#writing-new-helper-functions" class="anchor"></a><strong>Writing new helper functions</strong>
</h4>
<p>If you need to write new functionality for the package, and the same functionality already exists in a different function, it may make sense to take this functionality and put it into a separate function to save code. This approach is also helpful if there are long pieces of code which can be split into logical parts.</p>
<p>If writing a helper function, follow these steps:</p>
<ol>
<li><p>Add your function to the <code>helpers.R</code> file.</p></li>
<li><p>Write unit tests (as above). At a minimum you should have a test which takes generic data (of a similar format as the data that the function is designed to use) and tests that the function handles it correctly. If there is a chance that user actions could cause the function to fail, then have tests to ensure that the function fails as expected in these instances.</p></li>
<li><p>Write documentation using <code>#'</code> roxygen styling and then call <code>roxygen2::roxygenise()</code> when done to update the manual and NAMESPACE. There is no need to export your function but be sure to import any functions you do use from other packages.</p></li>
</ol>
</div>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by Sam Abbott, Katharine Sherratt, Hamish Gibbs, Joel Hellewell, James Munday, Paul Campbell, Sebastian Funk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


